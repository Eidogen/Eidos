service:
  name: eidos-jobs
  grpc_port: 50056
  http_port: 8086
  env: dev

# Nacos Service Discovery
nacos:
  enabled: false
  server_addr: localhost:8848
  namespace: eidos-dev
  group: EIDOS_GROUP
  username: ""
  password: ""
  log_dir: /tmp/nacos/log
  cache_dir: /tmp/nacos/cache
  timeout_ms: 5000
  heartbeat_interval_ms: 5000

# Database Configuration
postgres:
  host: ${DB_HOST:localhost}
  port: 5432
  database: eidos_jobs
  user: eidos
  password: eidos123
  max_connections: 10
  max_idle_conns: 5
  conn_max_lifetime: 1800

# Redis Configuration
redis:
  addresses:
    - ${REDIS_ADDR:localhost:6379}
  password: ""
  db: 0
  pool_size: 20            # 连接池大小
  min_idle_conns: 10       # 最小空闲连接数
  max_idle_conns: 50       # 最大空闲连接数
  conn_max_lifetime: 1800  # 连接最大生命周期-秒
  conn_max_idle_time: 300  # 空闲连接最大存活时间-秒
  dial_timeout: 5          # 连接超时-秒
  read_timeout: 3          # 读取超时-秒
  write_timeout: 3         # 写入超时-秒

# Kafka Configuration
kafka:
  enabled: true
  brokers:
    - ${KAFKA_BROKERS:localhost:9092}
  group_id: eidos-jobs
  client_id: eidos-jobs
  consumer:
    topics:
      - job-events
    auto_offset_reset: earliest
    max_poll_records: 100
  producer:
    topics:
      job_results: job-results
    compression: lz4
    batch_size: 100
    linger_ms: 10
    required_acks: -1

# gRPC Client Configuration
grpc_clients:
  trading:
    addr: ${GRPC_TRADING_ADDR:localhost:50051}
    timeout_ms: 30000
    max_retry: 3
  chain:
    addr: ${GRPC_CHAIN_ADDR:localhost:50054}
    timeout_ms: 30000
    max_retry: 3
  market:
    addr: ${GRPC_MARKET_ADDR:localhost:50053}
    timeout_ms: 30000
    max_retry: 3
  matching:
    addr: ${GRPC_MATCHING_ADDR:localhost:50052}
    timeout_ms: 30000
    max_retry: 3
  risk:
    addr: ${GRPC_RISK_ADDR:localhost:50055}
    timeout_ms: 30000
    max_retry: 3

# Health Check Endpoints (HTTP ports for service health monitoring)
health_endpoints:
  trading:
    url: ${HEALTH_TRADING_URL:http://localhost:8081/health}
    timeout_sec: 5
  matching:
    url: ${HEALTH_MATCHING_URL:http://localhost:8083/health}
    timeout_sec: 5
  market:
    url: ${HEALTH_MARKET_URL:http://localhost:8082/health}
    timeout_sec: 5
  chain:
    url: ${HEALTH_CHAIN_URL:http://localhost:8085/health}
    timeout_sec: 5
  risk:
    url: ${HEALTH_RISK_URL:http://localhost:8084/health}
    timeout_sec: 5

# Scheduler Configuration
scheduler:
  max_concurrent_jobs: 3
  job_timeout_minutes: 30
  retry_delay_sec: 60

# Job Definitions
jobs:
  health_monitor:
    enabled: true
    cron: "*/30 * * * * *"
    timeout_sec: 25

  cleanup_orders:
    enabled: true
    cron: "0 */1 * * * *"  # 每1分钟执行（原2分钟）
    timeout_sec: 50
    batch_size: 200

  stats_agg:
    enabled: true
    cron: "0 5 * * * *"
    timeout_sec: 300

  kline_agg:
    enabled: true
    cron: "0 0 * * * *"
    timeout_sec: 300

  reconciliation:
    enabled: true
    cron: "0 10 * * * *"
    timeout_sec: 600
    tolerance_percent: 0.01

  archive:
    enabled: true
    cron: "0 0 3 * * *"
    timeout_sec: 3600
    retention_days: 90

  data_cleanup:
    enabled: true
    cron: "0 0 4 * * *"
    timeout_sec: 3600
    retention_days: 365

  partition_mgmt:
    enabled: true
    cron: "0 0 2 1 * *"
    timeout_sec: 7200

  balance_scan:
    enabled: true
    cron: "0 */5 * * * *"
    batch_size: 100
    cancel_threshold_percent: 0.01
    max_concurrent_queries: 10
    enable_notification: true

  settlement_trigger:
    enabled: true
    cron: "0 */1 * * * *"
    batch_size: 100
    min_batch_size: 10
    max_wait_time_ms: 300000
    retry_timeout_ms: 600000
    max_retries: 3
    concurrent_batches: 2

# Notification Configuration
notification:
  enabled: false
  channels:
    slack:
      enabled: false
      webhook_url: ""
    email:
      enabled: false
      smtp_host: ""
      smtp_port: 587
      from_address: ""

# Prometheus Metrics
metrics:
  enabled: true
  port: 9096
  path: /metrics

# Logging Configuration
log:
  level: info
  format: color

# OpenTelemetry Tracing (Jaeger)
tracing:
  enabled: false                    # 是否启用链路追踪
  endpoint: ${TRACING_ENDPOINT:localhost:4317}  # OTLP gRPC 端点
  sample_rate: 1.0                  # 采样率 (0.0-1.0), 生产环境建议 0.1
  insecure: true                    # 是否使用不安全连接
  timeout_sec: 5                    # 连接超时（秒）

# Health Check
health:
  enabled: true
  path: /health
